<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/style/detail_style.css">
  <title>๋ธํธ ์์ธ</title>
</head>
<body>
  <div class="container">
    <div class="left-panel">
      <article>
        <h2><%= note.subject %></h2>
        <p>๊ต์: <%= note.professor %></p>
        <p>์นดํ๊ณ๋ฆฌ: <%= note.category %></p>
        <canvas id="pdf-canvas" width="400"></canvas>
        <div><%= note.summary %></div>
        <small>
          ์์ฑ์: <%= note.authorName %> /
          ์์ฑ์๊ฐ: <%= note.created_at.getFullYear() %>/<%= (note.created_at.getMonth()+1).toString().padStart(2,'0') %>/<%= note.created_at.getDate().toString().padStart(2,'0') %> <%= note.created_at.toLocaleTimeString('ko-KR') %>
        </small>
      </article>

      <% if (user && note.user_id === user.user_id) { %>
        <div>
          <a href="/notes/<%= note.id %>/edit">์์</a>
          <form method="POST" action="/notes/<%= note.id %>/delete" style="display:inline;">
            <button type="submit" onclick="return confirm('์๋ง ์ญ์ํ์๊ฒ์ต๋๊น?');">์ญ์</button>
          </form>
        </div>
      <% } %>
  
      <section class="comments">
        <h3>๋๊ธ</h3>
        <% if (comments.length) { %>
          <ul>
            <% comments.forEach(c => { %>
              <li><strong><%= c.author %>:</strong> <%= c.content %> <em>(<%= c.created_at.toLocaleString() %>)</em></li>
            <% }) %>
          </ul>
        <% } else { %>
          <p>๋๊ธ์ด ์์ต๋๋ค.</p>
        <% } %>

        <% if (user) { %>
          <form method="POST" action="/notes/<%= note.id %>/comments">
            <textarea name="content" placeholder="๋๊ธ ์๋ฅ" required></textarea>
            <button type="submit">๋๊ธ ์์ฑ</button>
          </form>
        <% } else { %>
          <p>๋๊ธ์ ์์ฑํ๋ค๋ฉด <a href="/login">๋ก๊ทธ์ธ</a>์ด ํ์ํฉ๋๋ค.</p>
        <% } %>
      </section>
      <a href="/notes">๋ชฉ๋ก์ผ๋ก ๋์๊ฐ๊ธฐ</a>
    </div>

    <div class="right-panel">
      <!-- ๋ค์ด๋ก๋ ๋ฐ์ค -->
      <div class="download-box">
        <h3>๋ค์ด๋ก๋</h3>
        <a id="downloadLink" href="<%= note.file_path %>" download class="download-btn">
          PDF ๋ค์ด๋ก๋
        </a>
        <div id="fileInfo" class="file-info">
          ํ์ผ๋ช: <%= note.file_name %><br>
          ์ฉ๋: <%= note.file_size %><br>
          ์๋ก๋: 
          <%= note.created_at.getFullYear() %>/
          <%= (note.created_at.getMonth() + 1).toString().padStart(2, '0') %>/
          <%= note.created_at.getDate().toString().padStart(2, '0') %>
        </div>
      </div>

      <!-- ์ข์์ & ๋ค์ด๋ก๋ ์ -->
      <div class="like-download-stats">
        <form method="POST" action="/notes/<%= note.id %>/like" style="margin-bottom: 10px;">
          <button id="likeBtn" type="submit">๐ ์ข์์ (<span id="likeCount"><%= note.like_count %></span>)</button>
        </form>
        <p>๐ฅ ๋ค์ด๋ก๋ ์: <span id="downloadCount"><%= note.download_count %></span></p>
      </div>
    </div>
  </div>
  <script>
    const pdfUrl = "<%= note.file_path %>";
  </script>
  <script type = "module" src ="/js/pdf_viewer.js"></script>

</body>
</html>